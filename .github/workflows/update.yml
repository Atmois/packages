# for each folder in ultramarine/
# if there is chkupdate.py
# run it every 2 hours
name: Automatically check for updates
on:
  schedule:
    - cron: "0 */2 * * *"
  workflow_dispatch:
  

jobs:
  autoupdate:
    runs-on: ubuntu-latest
    container:
      image: registry.fedoraproject.org/fedora:37
      options: --cap-add=SYS_ADMIN --privileged
    steps:
      - name: Install packages
        run: dnf install -y rpmdevtools git python

      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 2

      - name: Run Update
        run: bash ./update.sh

      - name: Save
        run: |
          if [[ `git status --porcelain` ]]; then
            git config user.name "Package Update Checker"
            git config user.email "<>"
            git commit -a -m "Automatic Update"
            git push -u origin main
            echo "updated=1" > $GITHUB_ENV
          fi
        
      - name: Autobuild
        if: ${{ steps.save.outputs.updated }}
        uses: ./.github/workflows/autobuild.yml
